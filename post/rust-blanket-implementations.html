<!doctype html><html lang=en><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://phillip-england.com/static/css/output.css><script src=https://unpkg.com/hyperscript.org@0.9.13></script><body class="h-screen flex flex-col dark:bg-black bg-white custom-scroll"><custom-scroll></custom-scroll><script>
        document.documentElement.classList.toggle('dark', localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches))
        window.addEventListener("DOMContentLoaded", () => {
            let sun = document.getElementById("sun");
            let moon = document.getElementById("moon");
            sun.addEventListener("click", () => {
                localStorage.theme = "light";
                document.documentElement.classList.toggle("dark");
            });
            moon.addEventListener("click", () => {
                localStorage.theme = "dark";
                document.documentElement.classList.toggle("dark");
            });
        });
    </script><hash-title-scroll offset=-140></hash-title-scroll><title>phillip england</title><main class="pt-[135px] flex-grow dark:bg-dracula-background bg-gray-200 flex flex-col sm:pl-[5%] sm:pr-[5%] md:pl-[10%] md:pr-[10%] lg:pr-[20%] lg:pl-[20%] xl:pr-[30%] xl:pl-[30%]"><header class="flex flex-col fixed top-0 h-[85px] dark:border-gray-800 border-b w-full xl:w-[40%] lg:w-[60%] sm:w-[90%] md:w-[80%] bg-white z-30 dark:bg-black"><div class="p-6 flex flex-row justify-between"><a href=https://phillip-england.com/index.html class=dark:hidden><img class="h-8 w-8" src=https://phillip-england.com/static/img/logo.svg>
</a><a href=https://phillip-england.com/index.html class="hidden dark:flex"><img class="h-8 w-8" src=https://phillip-england.com/static/img/logo-dark.svg></a><div _="on click toggle .hidden on #nav then toggle .hidden on #bars then toggle .hidden on #x" id=bars class="flex items-center xl:hidden"><svg class="h-8 w-8 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                <path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M5 7h14M5 12h14M5 17h14"></path>
            </svg></div><div _="on click toggle .hidden on #nav then toggle .hidden on #bars then toggle .hidden on #x" id=x class="flex items-center hidden xl:hidden"><svg class="h-8 w-8 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 17.94 6M18 18 6.06 6"></path>
            </svg></div></div></header><div class="flex fixed flex-row z-30 border-b dark:border-gray-800 bg-white items-center justify-between h-[50px] top-[85px] w-full dark:bg-black w-full xl:w-[40%] lg:w-[60%] sm:w-[90%] md:w-[80%]"><div class="flex flex-row items-center justify-center px-6 py-2 gap-2"><a href=https://github.com/phillip-england class="h-8 w-8 flex items-center justify-center"><svg class="dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                <path fill-rule="evenodd" d="M12.006 2a9.847 9.847 0 0 0-6.484 2.44 10.32 10.32 0 0 0-3.393 6.17 10.48 10.48 0 0 0 1.317 6.955 10.045 10.045 0 0 0 5.4 4.418c.504.095.683-.223.683-.494 0-.245-.01-1.052-.014-1.908-2.78.62-3.366-1.21-3.366-1.21a2.711 2.711 0 0 0-1.11-1.5c-.907-.637.07-.621.07-.621.317.044.62.163.885.346.266.183.487.426.647.71.135.253.318.476.538.655a2.079 2.079 0 0 0 2.37.196c.045-.52.27-1.006.635-1.37-2.219-.259-4.554-1.138-4.554-5.07a4.022 4.022 0 0 1 1.031-2.75 3.77 3.77 0 0 1 .096-2.713s.839-.275 2.749 1.05a9.26 9.26 0 0 1 5.004 0c1.906-1.325 2.74-1.05 2.74-1.05.37.858.406 1.828.101 2.713a4.017 4.017 0 0 1 1.029 2.75c0 3.939-2.339 4.805-4.564 5.058a2.471 2.471 0 0 1 .679 1.897c0 1.372-.012 2.477-.012 2.814 0 .272.18.592.687.492a10.05 10.05 0 0 0 5.388-4.421 10.473 10.473 0 0 0 1.313-6.948 10.32 10.32 0 0 0-3.39-6.165A9.847 9.847 0 0 0 12.007 2Z" clip-rule="evenodd"></path>
            </svg>
</a><a href=https://x.com/_PhillipEngland class="h-8 w-8 flex items-center justify-center"><svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
            <path d="M13.795 10.533 20.68 2h-3.073l-5.255 6.517L7.69 2H1l7.806 10.91L1.47 22h3.074l5.705-7.07L15.31 22H22l-8.205-11.467Zm-2.38 2.95L9.97 11.464 4.36 3.627h2.31l4.528 6.317 1.443 2.02 6.018 8.409h-2.31l-4.934-6.89Z"></path>
            </svg></a></div><div id=moon class="flex flex-row items-center justify-center px-6 py-2 dark:hidden"><svg class="w-6 h-6 flex items-center justify-center dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
            <path fill-rule="evenodd" d="M11.675 2.015a.998.998 0 0 0-.403.011C6.09 2.4 2 6.722 2 12c0 5.523 4.477 10 10 10 4.356 0 8.058-2.784 9.43-6.667a1 1 0 0 0-1.02-1.33c-.08.006-.105.005-.127.005h-.001l-.028-.002A5.227 5.227 0 0 0 20 14a8 8 0 0 1-8-8c0-.952.121-1.752.404-2.558a.996.996 0 0 0 .096-.428V3a1 1 0 0 0-.825-.985Z" clip-rule="evenodd"></path>
        </svg></div><div id=sun class="dark:flex flex-row items-center justify-center px-6 py-2 hidden"><svg class="w-6 h-6 flex items-center justify-center dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
            <path fill-rule="evenodd" d="M13 3a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0V3ZM6.343 4.929A1 1 0 0 0 4.93 6.343l1.414 1.414a1 1 0 0 0 1.414-1.414L6.343 4.929Zm12.728 1.414a1 1 0 0 0-1.414-1.414l-1.414 1.414a1 1 0 0 0 1.414 1.414l1.414-1.414ZM12 7a5 5 0 1 0 0 10 5 5 0 0 0 0-10Zm-9 4a1 1 0 1 0 0 2h2a1 1 0 1 0 0-2H3Zm16 0a1 1 0 1 0 0 2h2a1 1 0 1 0 0-2h-2ZM7.757 17.657a1 1 0 1 0-1.414-1.414l-1.414 1.414a1 1 0 1 0 1.414 1.414l1.414-1.414Zm9.9-1.414a1 1 0 0 0-1.414 1.414l1.414 1.414a1 1 0 0 0 1.414-1.414l-1.414-1.414ZM13 19a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2Z" clip-rule="evenodd"></path>
        </svg></div></div><nav id=nav class="w-full fixed top-[85px] xl:top-0 h-full left-0 sm:left-[5%] md:left-[10%] lg:left-[20%] xl:left-0 z-50 lg:w-[60%] sm:w-[90%] md:w-[80%] xl:w-[300px] flex-col hidden xl:flex"><ul class="flex flex-col dark:bg-black bg-white h-full p-4"><li class="bg-white text-black flex dark:bg-black dark:text-gray-200 hover:underline border-b border-gray-200 dark:border-gray-800"><a href=https://phillip-england.com/index.html class="p-4 w-full">Home</a><li class="bg-white text-black flex dark:bg-black dark:text-gray-200 hover:underline border-b border-gray-200 dark:border-gray-800"><a href=https://phillip-england.com/posts.html class="p-4 w-full">Posts</a></ul></nav><div class="h-full w-full top-0 fixed bg-black opacity-50 z-40 hidden"></div><article id=article class="flex-grow flex flex-col p-4 font-mono bg-white dark:bg-black dark:text-white overflow-auto"><div class="flex flex-col gap-4"><div class="flex flex-col gap-2"><h1 class="text-3xl font-bold">[rust blanket implementations]</h1><p class="text-xs text-gray-600 dark:text-gray-400">written 12/20/2024</div><p class=text-sm>extending core types in Rust<the-blinker rate=1000></the-blinker></p><img src=https://phillip-england.com/static/img/post/10.webp class="w-[150px] rounded">
<random-beads count=12 class=pb-6></random-beads></div><tw-markdown><div id=meta-data><div key=subtext value="extending core types in Rust"></div><div key=dob value=12/20/2024></div></div><h2 id=sandbox>Sandbox</h2><p>The sandbox for this article can be found <a href=https://github.com/Phillip-England/sandbox-rust-blanket-implementations>here</a>.<p>My conversation with ChatGPT regarding the topics can be found <a href=https://chatgpt.com/share/6766d509-bdb8-8005-a6eb-28fd226dd9e2>here</a>.<h2 id=discovery>Discovery</h2><p>I wanted to get started working on a simple string parsing library in Rust to get my feet wet, and to build a low-level primitive tool I can bring with me into future projects.<p>I basically want something that will allow me to do quick string operations I find myself performing frequently.<p><a href=https://github.com/phillip-england/purse>Here</a> is a tiny Go implementation of the sort of thing I am discussing.<p>Just some quick and dirty functions.<h2 id=rust-is-different>Rust is Different</h2><p>Upon researching how to lay out the library and the best methods to ensure my users can work with both <code>String</code> and <code>&amp;str</code>, I came across the idea of <a href=https://users.rust-lang.org/t/what-are-blanket-implementations/49904>blanket implementations</a>.<p>In Go, it made sense to use functions because Go only has one string type. But since Rust has multiple string types, we need to think about how to incorporate multiple types in our library.<p>I thought to myself, "Can I just create a trait and apply it to both <code>String</code> and <code>&amp;str</code>?"<p>The answer is, yes, using blanket implementations.<h2 id=compare-to-javascript>Compare to Javascript</h2><p>I think looking at how Javascript and Rust handle this idea is important as the Javascript example is a bit more easy to digest, but it has the same underlying idea.<p>In Javascript, let's imagine we want to take some object and extend it. Well, we could do something like this in the browser:<pre style=color:#f8f8f2;background-color:#282a36;><code><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style=color:#8be9fd;font-style:italic>window</span>.hello <span style=color:#ff79c6>=</span> () =&gt; {
</span></span><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>    console.log(<span style=color:#f1fa8c>&#39;hello from the window&#39;</span>);
</span></span><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>}
</span></span></code></pre><p>Then, later on in our program, we may call the method like:<pre style=color:#f8f8f2;background-color:#282a36;><code><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style=color:#8be9fd;font-style:italic>window</span>.hello();
</span></span><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style=color:#6272a4>// hello from the window
</span></span></span></code></pre><p>Javascript is prototype-based and allows you to directly mutate core objects in the language.<p>Rust does not provide us the ability to do this. So, in Rust, instead of directly altering core types, we can <em>extend</em> them using traits.<h2 id=traits-as-extensions>Traits as Extensions</h2><p>Traits can be implemented on types in a unique variety of ways.<p>NOTE TO SELF: Here I am again, discussing traits in Rust. Of all the features I've come across, traits seem to be one of the most fundamental building blocks of Rust.<p>Let's first start by defining a trait we wish to implement on <code>&amp;str</code> and <code>String</code>:<pre style=color:#f8f8f2;background-color:#282a36;><code><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>pub</span> <span style=color:#ff79c6>trait</span> SomeExtension {
</span></span><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>    <span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>shout</span>(<span style=color:#ff79c6>&amp;</span>self) -&gt; <span style=color:#8be9fd;font-style:italic>String</span>;
</span></span><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>}
</span></span></code></pre><h2 id=the-asref-trait>The AsRef Trait</h2><p>Rust has a trait named, <code>AsRef</code> which can be used to implement other traits on multiple core types at once.<p>Before we dive into how to use <code>AsRef</code> to implement <code>SomeExtension</code> on both <code>&amp;str</code> and <code>String</code>, we should take a closer look at how <code>AsRef</code> actually works.<p>You can find the <a href=https://doc.rust-lang.org/std/convert/trait.AsRef.html>docs</a> for <code>AsRef</code> here along with a <a href=https://web.mit.edu/rust-lang_v1.25/arch/amd64_ubuntu1404/share/doc/rust/html/book/first-edition/borrow-and-asref.html>page</a> that works through the <code>AsRef&lt;T></code> trait versus the <code>Borrow</code> trait.<p>One of the first things I've noticed is how the Rust standard library has a whole module called <code>convert</code> which might be useful to take a deeper dive into later. It might be a good idea to just study the standard library and see how the core Rust team codes their own data types.<p>NOTE TO SELF: Did you take the time to study the Rust standard library?<h2 id=implementing-our-extension>Implementing Our Extension</h2><p>Now that we know <code>AsRef</code> can be used to implement traits on multiple types in a generic way, we can use it to implement <code>SomeExtension</code> on both <code>&amp;str</code> and <code>String</code> types.<p>To implement <code>SomeExtension</code>, write:<pre style=color:#f8f8f2;background-color:#282a36;><code><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>impl</span><span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;</span> SomeExtension <span style=color:#ff79c6>for</span> T
</span></span><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style=color:#ff79c6>where</span>
</span></span><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>    T: <span style=color:#8be9fd;font-style:italic>AsRef</span><span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>str</span><span style=color:#ff79c6>&gt;</span>,
</span></span><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>{
</span></span><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>    <span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>shout</span>(<span style=color:#ff79c6>&amp;</span>self) -&gt; <span style=color:#8be9fd;font-style:italic>String</span> {
</span></span><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>        <span style=color:#8be9fd;font-style:italic>let</span> s <span style=color:#ff79c6>=</span> self.as_ref();
</span></span><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span>        format!(<span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>!&#34;</span>, s.to_uppercase())
</span></span><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span><span>    }
</span></span><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9</span><span>}
</span></span></code></pre><p>Then, we can use our extension like so:<pre style=color:#f8f8f2;background-color:#282a36;><code><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>fn</span> <span style=color:#50fa7b>main</span>() {
</span></span><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>    <span style=color:#8be9fd;font-style:italic>let</span> some_str <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;i am going to shout&#34;</span>;
</span></span><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>    <span style=color:#8be9fd;font-style:italic>let</span> shout <span style=color:#ff79c6>=</span> some_str.shout();
</span></span><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>    <span style=color:#8be9fd;font-style:italic>let</span> some_string <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>String</span>::from(<span style=color:#f1fa8c>&#34;i also shout&#34;</span>);
</span></span><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>    <span style=color:#8be9fd;font-style:italic>let</span> shout2 <span style=color:#ff79c6>=</span> some_string.shout();
</span></span><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>    println!(<span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c> - </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#34;</span>, shout, shout2);
</span></span><span style=display:flex;><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span>}
</span></span></code></pre><p>As you can see, <code>&amp;str</code> and <code>String</code> can now use the <code>shout</code> method from the <code>MyExtension</code> trait.<h2 id=conclusion>Conclusion</h2><p>Again, I am finding myself in a place where I feel the need to really dive deep into traits in Rust. They keep coming up and their generic syntax is one of the most challenging things about reading the language and getting a good mental model of it.<p>I am thinking I skim through <a href=https://doc.rust-lang.org/book/>The Book</a> over the next few days and just get some more general exposure to Rust concepts and to get better at looking at the code.</tw-markdown></article><footer class="bg-white p-4 border-t border-gray-200 dark:bg-black dark:text-white border-gray-200 dark:border-gray-800 text-sm"><p><i>"If you don't fight for your love, what kind of love do you have"</i> - Keanu Reeves</footer><title-links target=#article offset=-140 link-wrapper-class=flex link-class="p-4 w-full hover:underline border-b border-gray-200 dark:border-gray-800" class="fixed scrollbar-hidden overflow-y-scroll top-0 z-50 right-0 hidden xl:flex text-sm p-4 flex-col text-gray-600 dark:text-gray-400 h-full dark:bg-black bg-white hidden w-[300px]"></title-links></main><script src=https://phillip-england.com/static/js/index.js></script>